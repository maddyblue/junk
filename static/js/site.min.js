function validURL(a){return a.match("^[-A-Za-z0-9._~:/?#@!$&'()*+,;=% \\[\\]]+$")?!0:!1}function checkURL(a){return validURL(a)?!0:(alert("Invalid URL: "+a),!1)}function linkCheck(a,b){return $.tnm.linkmap[b]==a?"checked":""}function save(){if(!$.isEmptyObject(savemap)){$("#save").text("saving...");var a=savemap;backup=a,savemap={},$.post($.tnm.saveurl,a,function(a,b,c){var d=jQuery.parseJSON(a);$.each(d,function(a,b){var c=!1;$.each(b,function(b,d){$.tnm.imageurls[a][b]=d,b=="url"&&($("#"+a)[0].src=d),b=="orig"&&(c=!0)}),c&&($("#containerimg").css("background-image","url("+$.tnm.imageurls[a].orig+")"),loadimg(a),resize(0,{value:0}))}),$("#save").html("&nbsp;"),$("#saved").show().fadeOut(1e3)})}else $("#saved").show().fadeOut(1e3)}function loadimg(a){var b=$.tnm.imageurls[a];b.wscale=b.portw/b.basew,b.hscale=b.porth/b.baseh,b.min_scale=Math.max(b.wscale,b.hscale),b.max_scale=Math.max(b.min_scale*3),b.s=Math.max(b.min_scale,b.s),b.s=Math.min(b.max_scale,b.s),$("#imgslider").slider("destroy"),$("#imgslider").slider({orientation:"vertical",min:b.min_scale,max:b.max_scale,step:(b.max_scale-b.min_scale)/100,slide:resize,value:b.s})}function resize(a,b){var c=$.tnm.imageurls[cur_img],d=c.wscale,e=c.hscale,f=c.min_scale,g=c.max_scale,h=Math.max(c.min_scale,b.value);h=Math.min(c.max_scale,h);var i=c.basew*h,j=c.baseh*h,k=c.portw,l=c.porth,m=c.basetop,n=c.baseleft,o=.8;$("#containerimg").css({height:j,width:i}),$("#leftcontainer").css({width:i-k,height:l,top:j-l}),$("#rightcontainer").css({width:i-k,height:l,top:j-l}),$("#topcontainer").css({width:2*i-k,height:j-l}),$("#bottomcontainer").css({width:2*i-k,height:j-l}),$("#imgslider").css({top:j-l*(o+1)/2,left:i-20,height:l*o}),$("#imgcontainer").css({width:2*i-k,height:2*j-l,top:m+l-j,left:n+k-i});var p=$("#containerimg").position();p.left+i>2*i-k&&$("#containerimg").css({left:i-k}),p.top+j>2*j-l&&$("#containerimg").css({top:j-l}),c.x=p.left,c.y=p.top,c.s=h}var savemap={},cur_img;$(function(){function b(){$("#imgcontainer").remove()}var a;$("body").prepend('<div class="toolbar"><span id="save">&nbsp;</span> <span id="saved" style="display: none">saved</span> <span id="error" style="display: none"><b>error</b></span> <a id="view" href="'+$.tnm.viewurl+'">view</a>'+' <a id="publish" href="#">publish</a>'+' <a href="'+$.tnm.publishedurl+'">published</a>'+' <span id="publishing" style="display: none">publishing...</span>'+"</div>"),$("#save").ajaxError(function(){$(this).text("save"),$("#error").show().fadeOut(4e3),$.extend(savemap,a)}),$(document).on("click","#publish",function(){$.ajax({url:$.tnm.publishurl}),$("#publishing").show().fadeOut(4e3)}),$(".editable.text").each(function(){var a=this.id+"_text",b=this.id+"_focus",c=this.id+"_div",d='<div class="modal" id="'+c+'">'+'<p><label for="text">Text</label>'+'<input type="text" size="30" class="'+b+'" name="'+a+'" id="'+a+'" value="'+$(this).text()+'" /></p>'+'<p><a class="close text" href="#">save</a> <a href="#" class="cancel">cancel</a></p></div>';$(this).after(d)}),$(document).on("click",".close.text",function(){var a=$(this).parents("div").first().prev(),b=$("#"+a[0].id+"_text");return b[0].value&&(a.text(b[0].value),savemap[a[0].id]=a.html(),$(this).parents(".modal").hide(),save()),!1}),$(".editable.social").each(function(){var a="social",b="social_div",c='<div class="modal" style="color: black" id="'+b+'">'+'<p>Facebook: <input type="text" size="45" id="'+a+'_facebook" value="'+$.tnm.socialmap.facebook+'" /></p>'+'<p>Twitter: <input type="text" size="45" id="'+a+'_twitter" value="'+$.tnm.socialmap.twitter+'" /></p>'+'<p>YouTube: <input type="text" size="45" id="'+a+'_youtube" value="'+$.tnm.socialmap.youtube+'" /></p>'+'<p>flickr: <input type="text" size="45" id="'+a+'_flickr" value="'+$.tnm.socialmap.flickr+'" /></p>'+'<p>Linkedin: <input type="text" size="45" id="'+a+'_linkedin" value="'+$.tnm.socialmap.linkedin+'" /></p>'+'<p>Google+: <input type="text" size="45" id="'+a+'_google" value="'+$.tnm.socialmap.google+'" /></p>'+'<p><a class="close social" style="color: black" href="#">save</a> <a href="#" style="color: black" class="cancel">cancel</a></p></div>';$(this).after(c)}),$(document).on("click",".close.social",function(){return $.each($.tnm.socialmap,function(a,b){var c=$("#social_"+a)[0];if(!c.value||checkURL(c.value))savemap["_"+a]=c.value}),$(this).parents(".modal").hide(),save(),!1}),$(".editable.link").each(function(){var a=this.id+"_url",b=this.id+"_text",c=this.id+"_focus",d=this.id+"_div",e="";linkCheck("url",a)&&(e=this.name);var f='<div class="modal" id="'+d+'">'+"<p>Text: "+'<input type="text" size="45" class="'+c+'" name="'+b+'" id="'+b+'" value="'+$(this).text()+'" /></p>'+"<p>Link:</p>"+'<br><input type="radio" name="'+a+'" value="url" '+linkCheck("url",a)+'><input type="text" id="'+a+'_val" value="'+e+'">'+$.tnm.pagelinks[this.id]+'<p><a class="close link" href="#">save</a> <a href="#" class="cancel">cancel</a></p></div>';$(this).after(f)}),$(document).on("click",".close.link",function(){var a=$(this).parents("div").first(),b=a.prev(),c=$("#"+b[0].id+"_url_val"),d=$("#"+b[0].id+"_text"),e=$("input[name="+b[0].id+"_url]:radio:checked");if(e[0].value!="url"||checkURL(c[0].value)){var f;e[0].value=="url"?f=c[0].value:f=e[0].value,b.text(d[0].value),savemap[d[0].id]=b.html(),savemap[b[0].id+"_url"]=f,$(this).parents(".modal").hide(),save()}return!1}),$("a:has(img)").find(".editable.image").unwrap(),$(".editable.image").each(function(){var a=this.id+"_file",b=this.id+"_div",c=this.id+"_iframe",d=this.id+"_form",e=$.tnm.imageurls[this.id],f='<div class="modal" id="'+b+'">'+"<p>Upload ("+e.portw+"x"+e.porth+'): <form method="POST" id="'+d+'" target="'+c+'" enctype="multipart/form-data"><input type="file" id="'+a+'" name="'+a+'"></form><a class="upload image" href="#">upload</a></p>'+'<iframe id="'+c+'" src="#" style="width: 0; height: 0; border: 0px solid #fff;"></iframe>'+'<p>Existing: <select id="'+this.id+'_select">'+$.tnm.existingimgs+'</select> <a href="#" class="imgselect">use</a></p>'+'<p><a class="close image" href="#">save</a>'+' <a href="#" class="imgclear">clear</a>'+' <a href="#" class="cancel">cancel</a>'+"</p></div>";$(this).after(f)}),$(document).on("click",".close.image",function(){var a=$(this).parents("div").first(),c=a.prev(),d=$.tnm.imageurls[c[0].id];return resize(0,{value:d.s}),savemap[c[0].id+"_x"]=d.x,savemap[c[0].id+"_y"]=d.y,savemap[c[0].id+"_s"]=d.s,$(this).parents(".modal").hide(),b(),save(),!1}),$(document).on("click",".upload.image",function(){var a=$(this).parents("div").first(),b=a.prev(),c=$("#"+b[0].id+"_form");$.ajax({url:$.tnm.uploadurl+"?image="+b[0].id,success:function(a){c.attr("action",a),c.ajaxSubmit({success:function(a,c,d){if(a==""){alert("error during upload");return}var e=jQuery.parseJSON(a);b[0].src=e.url;var f=$.tnm.imageurls[b[0].id];f.url=e.url,f.orig=e.orig,f.basew=e.w,f.baseh=e.h,$("#containerimg").css("background-image","url("+f.orig+")"),loadimg(b[0].id),resize(0,{value:f.s})}})}})}),$(document).on("click",".editable.image",function(){b(),$(".modal").hide();var a='<div id="imgcontainer"><div id="topcontainer" class="containerdiv"></div><div id="leftcontainer" class="containerdiv"></div><span id="containerimg"></span><div id="imgslider"></div><div id="rightcontainer" class="containerdiv"></div><div id="bottomcontainer" class="containerdiv"></div></div>';$(this).before(a),cur_img=this.id;var c=$.tnm.imageurls[this.id];return $("#containerimg").draggable({containment:"parent"}),$("#containerimg").css("background-image","url("+c.orig+")"),loadimg(this.id),resize(0,{value:c.s}),!1}),$(document).on("click",".imgclear",function(){var a=$(this).parents("div").first(),c=a.prev();return $(this).parents(".modal").hide(),b(),savemap[c[0].id+"_c"]=!0,save(),!1}),$(document).on("click",".imgselect",function(){var a=$(this).parents("div").first(),b=a.prev(),c=$.tnm.imageurls[b[0].id];return savemap[b[0].id+"_b"]=$("#"+b[0].id+"_select")[0].value,save(),!1}),$(document).on("click",".editable",function(){return $("#"+this.id+"_div").show(),$("."+this.id+"_focus").focus(),!1}),$(document).on("click",".cancel",function(){return $(this).parents(".modal").hide(),b(),!1}),$(document).keyup(function(a){a.keyCode==27&&($(".modal").hide(),b())})}),function(a){function b(){var a="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(a):window.opera&&window.opera.postError&&window.opera.postError(a)}a.fn.ajaxSubmit=function(c){function t(e){function w(a){var b=a.contentWindow?a.contentWindow.document:a.contentDocument?a.contentDocument:a.document;return b}function x(){function h(){try{var a=w(n).readyState;b("state = "+a),a.toLowerCase()=="uninitialized"&&setTimeout(h,50)}catch(c){b("Server abort: ",c," (",c.name,")"),C(v),s&&clearTimeout(s),s=undefined}}var c=g.attr("target"),e=g.attr("action");f.setAttribute("target",l),d||f.setAttribute("method","POST"),e!=j.url&&f.setAttribute("action",j.url),!j.skipEncodingOverride&&(!d||/post/i.test(d))&&g.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),j.timeout&&(s=setTimeout(function(){r=!0,C(u)},j.timeout));var i=[];try{if(j.extraData)for(var k in j.extraData)i.push(a('<input type="hidden" name="'+k+'" />').attr("value",j.extraData[k]).appendTo(f)[0]);j.iframeTarget||(m.appendTo("body"),n.attachEvent?n.attachEvent("onload",C):n.addEventListener("load",C,!1)),setTimeout(h,15),f.submit()}finally{f.setAttribute("action",e),c?f.setAttribute("target",c):g.removeAttr("target"),a(i).remove()}}function C(c){if(o.aborted||B)return;try{z=w(n)}catch(d){b("cannot access response document: ",d),c=v}if(c===u&&o){o.abort("timeout");return}if(c==v&&o){o.abort("server abort");return}if(!z||z.location.href==j.iframeSrc)if(!r)return;n.detachEvent?n.detachEvent("onload",C):n.removeEventListener("load",C,!1);var e="success",f;try{if(r)throw"timeout";var g=j.dataType=="xml"||z.XMLDocument||a.isXMLDoc(z);b("isXml="+g);if(!g&&window.opera&&(z.body==null||z.body.innerHTML=="")&&--A){b("requeing onLoad callback, DOM not available"),setTimeout(C,250);return}var h=z.body?z.body:z.documentElement;o.responseText=h?h.innerHTML:null,o.responseXML=z.XMLDocument?z.XMLDocument:z,g&&(j.dataType="xml"),o.getResponseHeader=function(a){var b={"content-type":j.dataType};return b[a]},h&&(o.status=Number(h.getAttribute("status"))||o.status,o.statusText=h.getAttribute("statusText")||o.statusText);var i=j.dataType||"",l=/(json|script|text)/.test(i.toLowerCase());if(l||j.textarea){var p=z.getElementsByTagName("textarea")[0];if(p)o.responseText=p.value,o.status=Number(p.getAttribute("status"))||o.status,o.statusText=p.getAttribute("statusText")||o.statusText;else if(l){var q=z.getElementsByTagName("pre")[0],t=z.getElementsByTagName("body")[0];q?o.responseText=q.textContent?q.textContent:q.innerHTML:t&&(o.responseText=t.innerHTML)}}else j.dataType=="xml"&&!o.responseXML&&o.responseText!=null&&(o.responseXML=D(o.responseText));try{y=F(o,j.dataType,j)}catch(c){e="parsererror",o.error=f=c||e}}catch(c){b("error caught: ",c),e="error",o.error=f=c||e}o.aborted&&(b("upload aborted"),e=null),o.status&&(e=o.status>=200&&o.status<300||o.status===304?"success":"error"),e==="success"?(j.success&&j.success.call(j.context,y,"success",o),k&&a.event.trigger("ajaxSuccess",[o,j])):e&&(f==undefined&&(f=o.statusText),j.error&&j.error.call(j.context,o,e,f),k&&a.event.trigger("ajaxError",[o,j,f])),k&&a.event.trigger("ajaxComplete",[o,j]),k&&!--a.active&&a.event.trigger("ajaxStop"),j.complete&&j.complete.call(j.context,o,e),B=!0,j.timeout&&clearTimeout(s),setTimeout(function(){j.iframeTarget||m.remove(),o.responseXML=null},100)}var f=g[0],h,i,j,k,l,m,n,o,p,q,r,s,t=!!a.fn.prop;if(e)for(i=0;i<e.length;i++)h=a(f[e[i].name]),h[t?"prop":"attr"]("disabled",!1);if(a(":input[name=submit],:input[id=submit]",f).length){alert('Error: Form elements must not have name or id of "submit".');return}j=a.extend(!0,{},a.ajaxSettings,c),j.context=j.context||j,l="jqFormIO"+(new Date).getTime(),j.iframeTarget?(m=a(j.iframeTarget),q=m.attr("name"),q==null?m.attr("name",l):l=q):(m=a('<iframe name="'+l+'" src="'+j.iframeSrc+'" />'),m.css({position:"absolute",top:"-1000px",left:"-1000px"})),n=m[0],o={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(c){var d=c==="timeout"?"timeout":"aborted";b("aborting upload... "+d),this.aborted=1,m.attr("src",j.iframeSrc),o.error=d,j.error&&j.error.call(j.context,o,d,c),k&&a.event.trigger("ajaxError",[o,j,d]),j.complete&&j.complete.call(j.context,o,d)}},k=j.global,k&&!(a.active++)&&a.event.trigger("ajaxStart"),k&&a.event.trigger("ajaxSend",[o,j]);if(j.beforeSend&&j.beforeSend.call(j.context,o,j)===!1){j.global&&a.active--;return}if(o.aborted)return;p=f.clk,p&&(q=p.name,q&&!p.disabled&&(j.extraData=j.extraData||{},j.extraData[q]=p.value,p.type=="image"&&(j.extraData[q+".x"]=f.clk_x,j.extraData[q+".y"]=f.clk_y)));var u=1,v=2;j.forceSync?x():setTimeout(x,10);var y,z,A=50,B,D=a.parseXML||function(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b&&b.documentElement&&b.documentElement.nodeName!="parsererror"?b:null},E=a.parseJSON||function(a){return window.eval("("+a+")")},F=function(b,c,d){var e=b.getResponseHeader("content-type")||"",f=c==="xml"||!c&&e.indexOf("xml")>=0,g=f?b.responseXML:b.responseText;return f&&g.documentElement.nodeName==="parsererror"&&a.error&&a.error("parsererror"),d&&d.dataFilter&&(g=d.dataFilter(g,c)),typeof g=="string"&&(c==="json"||!c&&e.indexOf("json")>=0?g=E(g):(c==="script"||!c&&e.indexOf("javascript")>=0)&&a.globalEval(g)),g}}if(!this.length)return b("ajaxSubmit: skipping submit process - no element selected"),this;var d,e,f,g=this;typeof c=="function"&&(c={success:c}),d=this.attr("method"),e=this.attr("action"),f=typeof e=="string"?a.trim(e):"",f=f||window.location.href||"",f&&(f=(f.match(/^([^#]+)/)||[])[1]),c=a.extend(!0,{url:f,success:a.ajaxSettings.success,type:d||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},c);var h={};this.trigger("form-pre-serialize",[this,c,h]);if(h.veto)return b("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(c.beforeSerialize&&c.beforeSerialize(this,c)===!1)return b("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var i,j,k=this.formToArray(c.semantic);if(c.data){c.extraData=c.data;for(i in c.data)if(a.isArray(c.data[i]))for(var l in c.data[i])k.push({name:i,value:c.data[i][l]});else j=c.data[i],j=a.isFunction(j)?j():j,k.push({name:i,value:j})}if(c.beforeSubmit&&c.beforeSubmit(k,this,c)===!1)return b("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[k,this,c,h]);if(h.veto)return b("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var m=a.param(k);c.type.toUpperCase()=="GET"?(c.url+=(c.url.indexOf("?")>=0?"&":"?")+m,c.data=null):c.data=m;var n=[];c.resetForm&&n.push(function(){g.resetForm()}),c.clearForm&&n.push(function(){g.clearForm()});if(!c.dataType&&c.target){var o=c.success||function(){};n.push(function(b){var d=c.replaceTarget?"replaceWith":"html";a(c.target)[d](b).each(o,arguments)})}else c.success&&n.push(c.success);c.success=function(a,b,d){var e=c.context||c;for(var f=0,h=n.length;f<h;f++)n[f].apply(e,[a,b,d||g,g])};var p=a("input:file",this).length>0,q="multipart/form-data",r=g.attr("enctype")==q||g.attr("encoding")==q;if(c.iframe!==!1&&(p||c.iframe||r))c.closeKeepAlive?a.get(c.closeKeepAlive,function(){t(k)}):t(k);else{if(a.browser.msie&&d=="get"){var s=g[0].getAttribute("method");typeof s=="string"&&(c.type=s)}a.ajax(c)}return this.trigger("form-submit-notify",[this,c]),this},a.fn.ajaxForm=function(c){if(this.length===0){var d={s:this.selector,c:this.context};return!a.isReady&&d.s?(b("DOM not ready, queuing ajaxForm"),a(function(){a(d.s,d.c).ajaxForm(c)}),this):(b("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)")),this)}return this.ajaxFormUnbind().bind("submit.form-plugin",function(b){b.isDefaultPrevented()||(b.preventDefault(),a(this).ajaxSubmit(c))}).bind("click.form-plugin",function(b){var c=b.target,d=a(c);if(!d.is(":submit,input:image")){var e=d.closest(":submit");if(e.length==0)return;c=e[0]}var f=this;f.clk=c;if(c.type=="image")if(b.offsetX!=undefined)f.clk_x=b.offsetX,f.clk_y=b.offsetY;else if(typeof a.fn.offset=="function"){var g=d.offset();f.clk_x=b.pageX-g.left,f.clk_y=b.pageY-g.top}else f.clk_x=b.pageX-c.offsetLeft,f.clk_y=b.pageY-c.offsetTop;setTimeout(function(){f.clk=f.clk_x=f.clk_y=null},100)})},a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},a.fn.formToArray=function(b){var c=[];if(this.length===0)return c;var d=this[0],e=b?d.getElementsByTagName("*"):d.elements;if(!e)return c;var f,g,h,i,j,k,l;for(f=0,k=e.length;f<k;f++){j=e[f],h=j.name;if(!h)continue;if(b&&d.clk&&j.type=="image"){!j.disabled&&d.clk==j&&(c.push({name:h,value:a(j).val()}),c.push({name:h+".x",value:d.clk_x},{name:h+".y",value:d.clk_y}));continue}i=a.fieldValue(j,!0);if(i&&i.constructor==Array)for(g=0,l=i.length;g<l;g++)c.push({name:h,value:i[g]});else i!==null&&typeof i!="undefined"&&c.push({name:h,value:i})}if(!b&&d.clk){var m=a(d.clk),n=m[0];h=n.name,h&&!n.disabled&&n.type=="image"&&(c.push({name:h,value:m.val()}),c.push({name:h+".x",value:d.clk_x},{name:h+".y",value:d.clk_y}))}return c},a.fn.formSerialize=function(b){return a.param(this.formToArray(b))},a.fn.fieldSerialize=function(b){var c=[];return this.each(function(){var d=this.name;if(!d)return;var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;f<g;f++)c.push({name:d,value:e[f]});else e!==null&&typeof e!="undefined"&&c.push({name:this.name,value:e})}),a.param(c)},a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;d<e;d++){var f=this[d],g=a.fieldValue(f,b);if(g===null||typeof g=="undefined"||g.constructor==Array&&!g.length)continue;g.constructor==Array?a.merge(c,g):c.push(g)}return c},a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();c===undefined&&(c=!0);if(c&&(!d||b.disabled||e=="reset"||e=="button"||(e=="checkbox"||e=="radio")&&!b.checked||(e=="submit"||e=="image")&&b.form&&b.form.clk!=b||f=="select"&&b.selectedIndex==-1))return null;if(f=="select"){var g=b.selectedIndex;if(g<0)return null;var h=[],i=b.options,j=e=="select-one",k=j?g+1:i.length;for(var l=j?g:0;l<k;l++){var m=i[l];if(m.selected){var n=m.value;n||(n=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value);if(j)return n;h.push(n)}}return h}return a(b).val()},a.fn.clearForm=function(){return this.each(function(){a("input,select,textarea",this).clearFields()})},a.fn.clearFields=a.fn.clearInputs=function(){var a=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var b=this.type,c=this.tagName.toLowerCase();a.test(b)||c=="textarea"?this.value="":b=="checkbox"||b=="radio"?this.checked=!1:c=="select"&&(this.selectedIndex=-1)})},a.fn.resetForm=function(){return this.each(function(){(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)&&this.reset()})},a.fn.enable=function(a){return a===undefined&&(a=!0),this.each(function(){this.disabled=!a})},a.fn.selected=function(b){return b===undefined&&(b=!0),this.each(function(){var c=this.type;if(c=="checkbox"||c=="radio")this.checked=b;else if(this.tagName.toLowerCase()=="option"){var d=a(this).parent("select");b&&d[0]&&d[0].type=="select-one"&&d.find("option").selected(!1),this.selected=b}})}}(jQuery),function(a,b,c){var d="watermark",e="watermarkClass",f="watermarkFocus",g="watermarkSubmit",h="watermarkMaxLength",i="watermarkPassword",j="watermarkText",k=/\r/g,l="input:data("+d+"),textarea:data("+d+")",m="input:text,input:password,input[type=search],input:not([type]),textarea",n=["Page_ClientValidate"],o=!1,p="placeholder"in document.createElement("input");a.watermark=a.watermark||{version:"3.1.3",runOnce:!0,options:{className:"watermark",useNative:!0,hideBeforeUnload:!0},hide:function(b){a(b).filter(l).each(function(){a.watermark._hide(a(this))})},_hide:function(a,c){var d=a[0],f=(d.value||"").replace(k,""),g=a.data(j)||"",l=a.data(h)||0,m=a.data(e);if(g.length&&f==g){d.value="";if(a.data(i)&&(a.attr("type")||"")==="text"){var n=a.data(i)||[],o=a.parent()||[];n.length&&o.length&&(o[0].removeChild(a[0]),o[0].appendChild(n[0]),a=n)}l&&(a.attr("maxLength",l),a.removeData(h)),c&&(a.attr("autocomplete","off"),b.setTimeout(function(){a.select()},1))}m&&a.removeClass(m)},show:function(b){a(b).filter(l).each(function(){a.watermark._show(a(this))})},_show:function(b){var c=b[0],d=(c.value||"").replace(k,""),g=b.data(j)||"",l=b.attr("type")||"",m=b.data(e);if(d.length!=0&&d!=g||!!b.data(f))a.watermark._hide(b);else{o=!0;if(b.data(i)&&l==="password"){var n=b.data(i)||[],p=b.parent()||[];n.length&&p.length&&(p[0].removeChild(b[0]),p[0].appendChild(n[0]),b=n,b.attr("maxLength",g.length),c=b[0])}if(l==="text"||l==="search"){var q=b.attr("maxLength")||0;q>0&&g.length>q&&(b.data(h,q),b.attr("maxLength",g.length))}m&&b.addClass(m),c.value=g}},hideAll:function(){o&&(a.watermark.hide(m),o=!1)},showAll:function(){a.watermark.show(m)}},a.fn.watermark=a.fn.watermark||function(c,h){if(!this.length)return this;var l=!1,n=typeof c=="string";return n&&(c=c.replace(k,"")),typeof h=="object"?(l=typeof h.className=="string",h=a.extend({},a.watermark.options,h)):typeof h=="string"?(l=!0,h=a.extend({},a.watermark.options,{className:h})):h=a.watermark.options,typeof h.useNative!="function"&&(h.useNative=h.useNative?function(){return!0}:function(){return!1}),this.each(function(){var o=a(this);if(!o.is(m))return;if(o.data(d)){if(n||l)a.watermark._hide(o),n&&o.data(j,c),l&&o.data(e,h.className)}else{if(p&&h.useNative.call(this,o)&&(o.attr("tagName")||"")!=="TEXTAREA"){n&&o.attr("placeholder",c);return}o.data(j,n?c:""),o.data(e,h.className),o.data(d,1);if((o.attr("type")||"")==="password"){var q=o.wrap("<span>").parent(),r=a(q.html().replace(/type=["']?password["']?/i,'type="text"'));r.data(j,o.data(j)),r.data(e,o.data(e)),r.data(d,1),r.attr("maxLength",c.length),r.focus(function(){a.watermark._hide(r,!0)}).bind("dragenter",function(){a.watermark._hide(r)}).bind("dragend",function(){b.setTimeout(function(){r.blur()},1)}),o.blur(function(){a.watermark._show(o)}).bind("dragleave",function(){a.watermark._show(o)}),r.data(i,o),o.data(i,r)}else o.focus(function(){o.data(f,1),a.watermark._hide(o,!0)}).blur(function(){o.data(f,0),a.watermark._show(o)}).bind("dragenter",function(){a.watermark._hide(o)}).bind("dragleave",function(){a.watermark._show(o)}).bind("dragend",function(){b.setTimeout(function(){a.watermark._show(o)},1)}).bind("drop",function(a){var b=o[0],c=a.originalEvent.dataTransfer.getData("Text");(b.value||"").replace(k,"").replace(c,"")===o.data(j)&&(b.value=c),o.focus()});if(this.form){var s=this.form,t=a(s);t.data(g)||(t.submit(a.watermark.hideAll),s.submit?(t.data(g,s.submit),s.submit=function(b,c){return function(){var d=c.data(g);a.watermark.hideAll(),d.apply?d.apply(b,Array.prototype.slice.call(arguments)):d()}}(s,t)):(t.data(g,1),s.submit=function(b){return function(){a.watermark.hideAll(),delete b.submit,b.submit()}}(s)))}}a.watermark._show(o)})},a.watermark.runOnce&&(a.watermark.runOnce=!1,a.extend(a.expr[":"],{data:function(b,c,d){return!!a.data(b,d[3])}}),function(b){a.fn.val=function(){if(!this.length)return arguments.length?this:c;if(!arguments.length){if(this.data(d)){var e=(this[0].value||"").replace(k,"");return e===(this.data(j)||"")?"":e}return b.apply(this,arguments)}return b.apply(this,arguments),a.watermark.show(this),this}}(a.fn.val),n.length&&a(function(){var c,d,e;for(c=n.length-1;c>=0;c--)d=n[c],e=b[d],typeof e=="function"&&(b[d]=function(b){return function(){return a.watermark.hideAll(),b.apply(null,Array.prototype.slice.call(arguments))}}(e))}),a(b).bind("beforeunload",function(){a.watermark.options.hideBeforeUnload&&a.watermark.hideAll()}))}(jQuery,window);